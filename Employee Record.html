<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Employee Laptop Tracker</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
h1, h2 { margin-bottom: 10px; }
.stats { margin: 10px 0 20px; font-weight: bold; }
table { width: 100%; border-collapse: collapse; background: #fff; margin-bottom: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; }
th { background: #2c3e50; color: #fff; }
input { width: 100%; padding: 5px; box-sizing: border-box; }
.available { color: green; font-weight: bold; }
.inactive { background: #fceaea; }
.error { border: 2px solid red; }
button { padding: 6px 12px; margin-right: 6px; cursor: pointer; }
.active-tab { background:#2c3e50; color:#fff; }
</style>
</head>

<body>

<h1>Employee Laptop Assignment Tracker</h1>

<!-- Tabs -->
<button id="btnAdmin" onclick="switchMode('ADMIN')">Admin</button>
<button id="btnA" onclick="switchMode('A')">Production A</button>
<button id="btnB" onclick="switchMode('B')">Production B</button>

<br><br>

<input type="text" id="searchBox" placeholder="Search by employee name or asset number"
oninput="filterTable()" style="width:100%; padding:8px; margin-bottom:10px;">

<div class="stats">
Employees: <span id="employeeCount">0</span> |
Total Laptops: <span id="totalCount">0</span> |
Assigned Mice: <span id="mouseCount">0</span> |
Available Mice: <span id="availableMouseCount">0</span> |
Assigned Headsets: <span id="headsetCount">0</span> |
Available Headsets: <span id="availableHeadsetCount">0</span> |
Available Laptops: <span id="availableCount">0</span>
</div>

<table id="employeeTable">
<thead>
<tr>
<th>Employee Name</th>
<th>Laptop Brand</th>
<th>Vendor</th>
<th>Asset Number</th>
<th>Mouse Assigned</th>
<th>Headset Assigned</th>
<th>Status</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="addRow()">Add Employee</button>
<button onclick="exportExcel()">Export to Excel</button>
<button onclick="clearAll()">Clear Current Tab</button>

<h2>Available Laptops</h2>
<ul id="availableLaptops"></ul>

<h2>Available Mice & Headsets</h2>
<ul id="availableAccessories"></ul>

<script>
let currentMode = 'A'; // ADMIN | A | B
let employees = [];

function storageKey() {
  if (currentMode === 'ADMIN') return 'employees_admin';
  return `employees_prod${currentMode}`;
}

function loadData() {
  employees = JSON.parse(localStorage.getItem(storageKey())) ||
    [{ name:'', brand:'', vendor:'', asset:'', mouse:'', headset:'' }];
}

function save() {
  localStorage.setItem(storageKey(), JSON.stringify(employees));
}

function switchMode(mode) {
  currentMode = mode;

  btnAdmin.classList.toggle('active-tab', mode === 'ADMIN');
  btnA.classList.toggle('active-tab', mode === 'A');
  btnB.classList.toggle('active-tab', mode === 'B');

  loadData();
  render();
}

function render() {
  const tbody = document.querySelector('#employeeTable tbody');
  tbody.innerHTML = '';

  employees.forEach((emp, i) => {
    const row = document.createElement('tr');
    row.dataset.index = i;
    if (!emp.name) row.classList.add('inactive');

    row.innerHTML = `
      <td><input value="${emp.name}" data-i="${i}" data-f="name"></td>
      <td><input value="${emp.brand}" data-i="${i}" data-f="brand"></td>
      <td><input value="${emp.vendor}" data-i="${i}" data-f="vendor"></td>
      <td><input value="${emp.asset}" data-i="${i}" data-f="asset"></td>
      <td><input value="${emp.mouse}" data-i="${i}" data-f="mouse"></td>
      <td><input value="${emp.headset}" data-i="${i}" data-f="headset"></td>
      <td>${emp.name ? 'Active' : 'Inactive'}</td>
    `;
    tbody.appendChild(row);
  });

  attachListeners();
  updateStats();
  renderAvailable();
  highlightDuplicateAssets();
  filterTable();
}

function attachListeners() {
  document.querySelectorAll('input[data-i]').forEach(input => {
    input.oninput = function () {
      employees[this.dataset.i][this.dataset.f] = this.value;
      save();
      updateStats();
      renderAvailable();
      highlightDuplicateAssets();
    };

    input.onkeydown = function (e) {
      if (e.key === 'Enter' && this.dataset.i == employees.length - 1) {
        e.preventDefault();
        addRow();
      }
    };
  });
}

function addRow() {
  employees.push({ name:'', brand:'', vendor:'', asset:'', mouse:'', headset:'' });
  save();
  render();
}

function clearAll() {
  const label = currentMode === 'ADMIN' ? 'Admin' : 'Production ' + currentMode;
  if (confirm(`Clear all data for ${label}?`)) {
    employees = [{ name:'', brand:'', vendor:'', asset:'', mouse:'', headset:'' }];
    save();
    render();
  }
}

function updateStats() {
  employeeCount.textContent = employees.filter(e => e.name).length;
  totalCount.textContent = employees.filter(e => e.asset).length;
  mouseCount.textContent = employees.filter(e => e.mouse).length;
  headsetCount.textContent = employees.filter(e => e.headset).length;
  availableCount.textContent = employees.filter(e => !e.name && e.asset).length;
  availableMouseCount.textContent = employees.filter(e => !e.name && e.mouse).length;
  availableHeadsetCount.textContent = employees.filter(e => !e.name && e.headset).length;
}

function renderAvailable() {
  availableLaptops.innerHTML = '';
  availableAccessories.innerHTML = '';

  employees.forEach(e => {
    if (!e.name && e.asset)
      availableLaptops.innerHTML += `<li class="available">${e.brand} - ${e.vendor} - ${e.asset}</li>`;
    if (!e.name && e.mouse)
      availableAccessories.innerHTML += `<li class="available">Mouse: ${e.mouse}</li>`;
    if (!e.name && e.headset)
      availableAccessories.innerHTML += `<li class="available">Headset: ${e.headset}</li>`;
  });
}

function highlightDuplicateAssets() {
  const map = {};
  employees.forEach(e => {
    if (e.name && e.asset) map[e.asset] = (map[e.asset] || 0) + 1;
  });

  document.querySelectorAll('#employeeTable tbody tr').forEach((row,i)=>{
    const assetInput = row.querySelectorAll('input')[3];
    assetInput.classList.toggle('error', map[employees[i].asset] > 1);
  });
}

function exportExcel() {
  let csv = 'Employee,Laptop Brand,Vendor,Asset,Mouse,Headset,Status\n';
  employees.forEach(e=>{
    csv += `"${e.name}","${e.brand}","${e.vendor}","${e.asset}","${e.mouse}","${e.headset}","${e.name?'Active':'Inactive'}"\n`;
  });
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${currentMode}_Laptop_Report.csv`;
  a.click();
}

function filterTable() {
  const s = searchBox.value.toLowerCase();
  document.querySelectorAll('#employeeTable tbody tr').forEach(r=>{
    const e = employees[r.dataset.index];
    r.style.display =
      e.name.toLowerCase().includes(s) || e.asset.toLowerCase().includes(s)
      ? '' : 'none';
  });
}

/* INIT */
switchMode('A');
</script>

</body>
</html>
